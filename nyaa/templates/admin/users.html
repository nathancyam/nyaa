{% extends "layout.html" %}

{% macro render_user_level(user) %}
    <select name="level" class="form-control edit-mode" data-action="level-select">
        <option value="0" {% if user.level == 0 %}selected{% endif %}>Regular</option>
        <option value="1" {% if user.level == 1 %}selected{% endif %}>Trusted</option>
        <option value="2" {% if user.level == 2 %}selected{% endif %}>Admin</option>
        <option value="3" {% if user.level == 3 %}selected{% endif %}>Super Admin</option>
    </select>
{% endmacro %}

{% block title %}Admin Dashboard - Users{% endblock %}

{% block body %}
    <h1>Users</h1>

    <div class="row actions">
        <div class="col-md-12">
            <form method="post" class="form-inline" id="mass-actions">
                <div class="form-group">
                    <input type="hidden" name="selected_ids" value="">
                    <button class="btn btn-default" id="select-all">Select All</button>
                    <select name="action" class="form-control">
                        <option value="ban">Ban</option>
                        <option value="level-change">Level Change</option>
                    </select>
                    <select name="level" class="form-control hidden">
                        <option value="0">Regular</option>
                        <option value="1">Trusted</option>
                        <option value="2">Admin</option>
                        <option value="3">Super Admin</option>
                    </select>
                    <button type="submit" class="btn btn-default">Apply</button>
                </div>
            </form>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <table class="table user-table">
                <thead>
                    <tr>
                        <th></th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Created Time</th>
                        <th>Last Login Date</th>
                        <th>Last IP</th>
                        <th>Status</th>
                        <th>Level</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                        <tr class="row-user row-edit">
                            <td>
                                <input type="checkbox" class="checkbox" data-user-id="{{ user.id }}">
                            </td>
                            <td class="user">{{ user.username | safe }}</td>
                            <td class="email">{{ user.email | safe }}</td>
                            <td class="created-time">{{ user.created_time }}</td>
                            <td class="login-date">{{ user.last_login_date }}</td>
                            <td class="login-ip">{{ user.last_login_ip }}</td>
                            <td class="status">
                                <span class="label label-primary static-mode">{{ form.status_text(user.status) }}</span>
                                {% if user.status == 2 %}
                                    <button type="button" class="btn btn-sm btn-success edit-mode" data-action="unban">Unban</button>
                                {% else %}
                                    <button type="button" class="btn btn-sm btn-danger edit-mode" data-action="ban">Ban</button>
                                {% endif %}
                            </td>
                            <td class="level">
                                <span class="label label-primary static-mode">{{ form.level_text(user.level) }}</span>
                                {{ render_user_level(user) }}
                            </td>
                            <td class="actions">
                                <form action="/admin/user/{{ user.id }}" method="post" class="form-inline edit-form">
                                    {{ form.csrf_token }}
                                    <input type="hidden" value="{{ user.status.value }}" name="banned">
                                    <input type="hidden" value="{{ user.level | int }}" name="levels">
                                    <button class="btn btn-sm btn-info edit-btn" data-action="edit"></button>
                                    <button type="submit" class="btn btn-sm btn-primary edit-mode">Submit</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <script src="/static/js/admin.js"></script>
{% endblock %}
